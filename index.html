<!DOCTYPE html>
<head>
    <title>Portfolio Drawdown Monte Carlo</title>
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.1/chart.min.js" integrity="sha512-QSkVNOCYLtj73J4hbmVoOV6KVZuMluZlioC+trLpewV8qMjsWqlIQvkn1KGX2StWvPMdWGBqim1xlC8krl1EKQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script> -->
</head>
<body>
    <h1>Portfolio Drawdown Monte Carlo</h1>
    <p>This simulation uses historical market data to determine how your portfolio will fare over 30 or 50 years of retirement. It is inspired by 
        <a href="https://retirementplans.vanguard.com/VGApp/pe/pubeducation/calculators/RetirementNestEggCalc.jsf">Vanguard's Retirement Nest Egg Calculator</a>
        but with (in my opinion) better visualizations. 
    </p>

    <canvas id="myChart" width="400px" height="400px"></canvas>
    <script src="./out/monteCarlo.bundle.js" type="module"></script>
    <script type="module">
        import { MonteCarloInputs, runMonteCarlo, simulationStats } from "./out/monteCarlo.bundle.js";
        import { Chart, registerables } from "https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.esm.js";
        Chart.register(...registerables);

        var ctx = document.getElementById('myChart').getContext('2d');
        
        var chart = new Chart(ctx, {
            // The type of chart we want to create
            type: 'line',

            // The data for our dataset
            data: {
                labels: Object.keys(simulationStats),
                datasets: [{ // 0
                    label: "min",
                    backgroundColor: 'rgba(255, 0, 255, 0.5)',
                    borderColor: 'rgb(255, 99, 132)',
                    data: Object.values(simulationStats).map(s => s.min),
                    //fill: '+1', 
                },
                // { // 1
                //     label: "max",
                //     // backgroundColor: 'rgb(255, 255, 132)',
                //     // borderColor: 'rgb(255, 255, 132)',
                //     data: Object.values(simulationStats).map(s => s.max),
                // },
                { 
                    label: "mean",
                    backgroundColor: 'rgb(0, 255, 0)',
                    borderColor: 'rgb(0, 0, 0)',
                    data: Object.values(simulationStats).map(s => s.mean),
                },
                // { 
                //     label: "median",
                //     backgroundColor: 'rgb(0, 255, 0)',
                //     borderColor: 'rgb(255, 255, 132)',
                //     data: Object.values(simulationStats).map(s => s.median),
                // },
                { 
                    label: "stddev_low",
                    backgroundColor: 'rgb(255, 255, 132)',
                    borderColor: 'rgb(255, 255, 132)',
                    data: Object.values(simulationStats).map(s => s.mean - s.stddev),
                    //fill: '+1'
                },
                { 
                    label: "stddev_high",
                    backgroundColor: 'rgb(255, 255, 132)',
                    borderColor: 'rgb(255, 255, 132)',
                    data: Object.values(simulationStats).map(s => s.mean + s.stddev),
                },
                { 
                    label: "q0",
                    backgroundColor: 'rgb(0, 0, 0)',
                    borderColor: 'rgb(255, 0, 0)',
                    data: Object.values(simulationStats).map(s => s.quantiles[0]),
                },
                { 
                    label: "q1",
                    backgroundColor: 'rgb(0, 0, 0)',
                    borderColor: 'rgb(255, 0, 0)',
                    data: Object.values(simulationStats).map(s => s.quantiles[1]),
                },
                { 
                    label: "q2",
                    backgroundColor: 'rgb(0, 0, 0)',
                    borderColor: 'rgb(255, 0, 0)',
                    data: Object.values(simulationStats).map(s => s.quantiles[2]),
                },
            ]
            },

            // Configuration options go here
            options: {}
        });
    </script>
</body>
</html>